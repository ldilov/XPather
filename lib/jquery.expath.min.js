function normalizeXpath(selector){var newText='',selectorTextRegex=new RegExp(/(['"])(.*?)\1/g),regexNormalizer=new RegExp(/[-\/\\^*+?.()|[\]{}$]/g),normalizer="lower-case(normalize-space({INPUT}))";var regSelText,replRegex;if(!selector){return selector}
var resultSelector=selector;while((match=selectorTextRegex.exec(selector))!==null){newText=match[1]+match[2]+match[1];newText=newText.replace(/\$/g,'$$$&');var normText;normText=normalizer.replace(/\{INPUT\}/,newText);regSelText=match[0].replace(regexNormalizer,'\\$&');replRegex=new RegExp(regSelText,'gi');normText=normText.replace(/\$/g,'$$$&');resultSelector=resultSelector.replace(replRegex,normText)}
var inputOptionsRegex=new RegExp(/(@[A-Za-z0-9\-:_]+|(?:text|name)\(\)|\.)\s*[,=]\s*['"]/g);while((inputOptionsMatch=inputOptionsRegex.exec(selector))!==null){var originalInputOption=inputOptionsMatch[1];var inputOption=originalInputOption.replace(regexNormalizer,'\\$&');inputOption=inputOption.replace(/\$/g,'$$$&');var regEx=new RegExp(inputOption+'(\\s*(?:,|=))','g');var norm;norm=normalizer.replace(/\{INPUT\}/,originalInputOption);norm=norm.replace(/\$/g,'$$$&');resultSelector=resultSelector.replace(regEx,norm+'$1')}
resultSelector=resultSelector.replace(/text\(\)/g,"string-join(text(), ' ')")
return resultSelector}
jQuery.fn.extend({expath:function(selector){return this.xpath(normalizeXpath(selector))}})